# **Elasticsearch åŸºæœ¬è¯­æ³•æŒ‡å—**

Elasticsearch (ES) æ˜¯ä¸€ä¸ªåŸºäº Lucene çš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼Œå¸¸ç”¨äºå…¨æ–‡æ£€ç´¢ã€æ—¥å¿—åˆ†æå’Œå¤§æ•°æ®å¤„ç†ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒè¯­æ³•å’Œå¸¸è§æ“ä½œï¼š

------

## **1. ç´¢å¼•ç®¡ç†**

### **åˆ›å»ºç´¢å¼•**

```plain
PUT /ç´¢å¼•å
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1
  },
  "mappings": {
    "properties": {
      "å­—æ®µ1": { "type": "text" },
      "å­—æ®µ2": { "type": "keyword" },
      "å­—æ®µ3": { "type": "integer" }
    }
  }
}
```

- `**number_of_shards**`ï¼šåˆ†ç‰‡æ•°ï¼ˆé»˜è®¤ 1ï¼‰
- `**number_of_replicas**`ï¼šå‰¯æœ¬æ•°ï¼ˆé»˜è®¤ 1ï¼‰

### **æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯**

GET /ç´¢å¼•å

### **åˆ é™¤ç´¢å¼•**

DELETE /ç´¢å¼•å

------

## **2. æ–‡æ¡£æ“ä½œ**

### **æ·»åŠ /æ›´æ–°æ–‡æ¡£**

```plain
POST /ç´¢å¼•å/_doc/æ–‡æ¡£ID
{
  "å­—æ®µ1": "å€¼1",
  "å­—æ®µ2": "å€¼2"
}
```

- ä¸æŒ‡å®š `**æ–‡æ¡£ID**` æ—¶ï¼ŒES ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚

### **è·å–æ–‡æ¡£**

GET /ç´¢å¼•å/_doc/æ–‡æ¡£ID

### **åˆ é™¤æ–‡æ¡£**

DELETE /ç´¢å¼•å/_doc/æ–‡æ¡£ID

### **æ‰¹é‡æ“ä½œï¼ˆBulk APIï¼‰**

```plain
POST /_bulk
{ "index": { "_index": "ç´¢å¼•å", "_id": "1" } }
{ "å­—æ®µ1": "å€¼1", "å­—æ®µ2": "å€¼2" }
{ "delete": { "_index": "ç´¢å¼•å", "_id": "2" } }
```

------

## **3. æŸ¥è¯¢æ•°æ®**

### **ç®€å•æŸ¥è¯¢ï¼ˆMatch Queryï¼‰**

```plain
GET /ç´¢å¼•å/_search
{
  "query": {
    "match": {
      "å­—æ®µå": "æœç´¢è¯"
    }
  }
}
```

### **ç²¾ç¡®åŒ¹é…ï¼ˆTerm Queryï¼‰**

```plain
GET /ç´¢å¼•å/_search
{
  "query": {
    "term": {
      "å­—æ®µå": "ç²¾ç¡®å€¼"
    }
  }
}
```

### **èŒƒå›´æŸ¥è¯¢ï¼ˆRange Queryï¼‰**

```plain
GET /ç´¢å¼•å/_search
{
  "query": {
    "range": {
      "æ•°å€¼å­—æ®µ": {
        "gte": 10,
        "lte": 20
      }
    }
  }
}
```

### **å¸ƒå°”æŸ¥è¯¢ï¼ˆBool Queryï¼‰**



```plain
GET /ç´¢å¼•å/_search
{
  "query": {
    "bool": {
      "must": [ { "match": { "å­—æ®µ1": "A" } } ],
      "should": [ { "match": { "å­—æ®µ2": "B" } } ],
      "must_not": [ { "range": { "å­—æ®µ3": { "lte": 10 } } } ]
    }
  }
}
```

- `**must**`ï¼šå¿…é¡»åŒ¹é…ï¼ˆANDï¼‰
- `**should**`ï¼šåº”è¯¥åŒ¹é…ï¼ˆORï¼‰
- `**must_not**`ï¼šå¿…é¡»ä¸åŒ¹é…ï¼ˆNOTï¼‰

### **èšåˆæŸ¥è¯¢ï¼ˆAggregationï¼‰**

```plain
GET /ç´¢å¼•å/_search
{
  "aggs": {
    "èšåˆåç§°": {
      "terms": { "field": "å­—æ®µå" }
    }
  }
}
```

------

## **4. å¸¸ç”¨è¿‡æ»¤**

### **åˆ†é¡µæŸ¥è¯¢**

```plain
GET /ç´¢å¼•å/_search
{
  "from": 0,
  "size": 10,
  "query": { "match_all": {} }
}
```

- `**from**`ï¼šèµ·å§‹ä½ç½®
- `**size**`ï¼šæ¯é¡µæ•°é‡

### **æ’åº**

```plain
GET /ç´¢å¼•å/_search
{
  "sort": [
    { "å­—æ®µå": { "order": "asc" } }
  ]
}
```

### **é«˜äº®æ˜¾ç¤º**

```plain
GET /ç´¢å¼•å/_search
{
  "query": { "match": { "å­—æ®µå": "æœç´¢è¯" } },
  "highlight": {
    "fields": { "å­—æ®µå": {} }
  }
}
```

------

## **5. ç´¢å¼•åˆ«å**

### **åˆ›å»ºåˆ«å**

```plain
POST /_aliases
{
  "actions": [
    { "add": { "index": "ç´¢å¼•å", "alias": "åˆ«å" } }
  ]
}
```

### **åˆ‡æ¢åˆ«åï¼ˆé›¶åœæœºæ—¶é—´ï¼‰**

```plain
POST /_aliases
{
  "actions": [
    { "remove": { "index": "æ—§ç´¢å¼•", "alias": "åˆ«å" } },
    { "add": { "index": "æ–°ç´¢å¼•", "alias": "åˆ«å" } }
  ]
}
```

------

## **6. é›†ç¾¤ç®¡ç†**

### **æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶æ€**

GET /_cluster/health

### **æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯**

GET /_cat/nodes?v

### **æŸ¥çœ‹ç´¢å¼•çŠ¶æ€**

GET /_cat/indices?v

------

## **æ€»ç»“**

| **æ“ä½œç±»å‹**  | **ç¤ºä¾‹**                                           |
| ------------- | -------------------------------------------------- |
| **ç´¢å¼•ç®¡ç†**  | `**PUT /ç´¢å¼•å**`, `**DELETE /ç´¢å¼•å**`            |
| **æ–‡æ¡£æ“ä½œ**  | `**POST /ç´¢å¼•å/_doc**`, `**GET /ç´¢å¼•å/_doc/ID**` |
| **æŸ¥è¯¢**      | `**match**`, `**term**`, `**bool**`, `**range**`   |
| **èšåˆ**      | `**aggs**`                                         |
| **åˆ†é¡µ/æ’åº** | `**from**`, `**size**`, `**sort**`                 |
| **é«˜äº®**      | `**highlight**`                                    |
| **åˆ«å**      | `**POST /_aliases**`                               |
| **é›†ç¾¤ç®¡ç†**  | `**GET /_cluster/health**`                         |

å¦‚æœä½ æœ‰ç‰¹å®šçš„ Elasticsearch ä½¿ç”¨åœºæ™¯ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šæä¾›æ›´è¯¦ç»†çš„ç¤ºä¾‹ï¼ ğŸš€